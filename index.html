<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
<title>Evermark - Content Curation</title>

<!-- FIXED CSP: Added frame-ancestors and removed conflicts -->
<meta http-equiv="Content-Security-Policy" content="
      default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob:;
      connect-src 'self' https: wss: data: blob:;
      script-src 'self' 'unsafe-inline' 'unsafe-eval' https: https://cdn.jsdelivr.net;
      img-src 'self' https: data: blob:;
      font-src 'self' data: https:;
      media-src 'self' blob: https:;
      worker-src 'self' blob:;
      child-src 'self' blob:;
      frame-src 'self' https:;
      frame-ancestors *;
      object-src 'none';
      base-uri 'self';
    ">

<!-- Farcaster Mini App Frame Embed -->
<meta name="fc:frame" content='{"version":"next","imageUrl":"https://evermarks.net/og-image.png","button":{"title":"üìñ Open Evermark","action":{"type":"launch_frame","name":"Evermark","url":"https://evermarks.net","splashImageUrl":"https://evermarks.net/splash.png","splashBackgroundColor":"#7c3aed"}}}' />

<!-- Legacy Farcaster Frame Support -->
<meta name="fc:frame:image" content="https://evermarks.net/og-image.png" />
<meta name="fc:frame:button:1" content="üìñ Open Evermark" />
<meta name="fc:frame:button:1:action" content="link" />
<meta name="fc:frame:button:1:target" content="https://evermarks.net" />

<!-- Open Graph Meta Tags -->
<meta property="og:title" content="Evermark - Content Curation on Blockchain" />
<meta property="og:description" content="Preserve and curate your favorite content on the blockchain. Vote on quality content and participate in community-driven leaderboards." />
<meta property="og:image" content="https://evermarks.net/og-image.png" />
<meta property="og:url" content="https://evermarks.net" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="Evermark" />

<!-- Twitter Card Meta Tags -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="Evermark - Content Curation on Blockchain" />
<meta name="twitter:description" content="Preserve and curate your favorite content on the blockchain. Vote on quality content and participate in community-driven leaderboards." />
<meta name="twitter:image" content="https://evermarks.net/og-image.png" />

<!-- App-specific Meta Tags -->
<meta name="description" content="Preserve and curate your favorite content on the blockchain. Vote on quality content and participate in community-driven leaderboards." />
<meta name="keywords" content="blockchain, content curation, voting, farcaster, web3, evermark" />
<meta name="author" content="Evermark" />

<!-- Theme and App Icons -->
<meta name="theme-color" content="#7c3aed" />
<link rel="icon" type="image/png" href="/icon.png" />
<link rel="apple-touch-icon" href="/icon.png" />

<!-- PWA Manifest -->
<link rel="manifest" href="/manifest.json" />
</head>
<body>
<div id="root"></div>

<!-- FIXED: Mobile-first Farcaster SDK initialization -->
<script>
  // Early detection and immediate ready signal for mobile
  (function() {
    console.log('üîÑ Early SDK check...');
    
    const isInFarcaster = (() => {
      try {
        return window.parent !== window || 
               window.location !== window.parent.location ||
               window.frameElement !== null ||
               navigator.userAgent.includes('Farcaster') ||
               document.referrer.includes('warpcast.com');
      } catch (e) {
        return true; // If we can't check, assume we're in frame
      }
    })();
    
    console.log('üì± Is in Farcaster:', isInFarcaster);
    
    if (isInFarcaster) {
      // Mobile-optimized SDK loading
      const script = document.createElement('script');
      script.src = 'https://cdn.jsdelivr.net/npm/@farcaster/frame-sdk@latest/dist/index.min.js';
      script.async = true;
      script.onload = function() {
        console.log('‚úÖ SDK loaded via script tag');
        try {
          if (window.FrameSDK) {
            window.FrameSDK.actions.ready();
            console.log('‚úÖ Ready signal sent immediately');
          }
        } catch (error) {
          console.error('‚ùå Ready signal failed:', error);
        }
      };
      script.onerror = function(error) {
        console.error('‚ùå SDK script loading failed:', error);
      };
      document.head.appendChild(script);
    }
  })();
</script>

<script type="module" src="/src/main.tsx"></script>
</body>
</html>